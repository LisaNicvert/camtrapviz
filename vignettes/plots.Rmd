---
title: "Plots"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Plots}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette demonstrates how this package can be used to plot camera trap data.

```{r setup, message=FALSE, results='hide'}
library(camtrapviz)
library(dplyr)
library(ggiraph)
library(RColorBrewer)
```

## Import and prepare data

```{r}
data(recordTableSample, package = "camtrapR")
data(camtraps, package = "camtrapR")
```

```{r}
recordTableSample$DateTimeOriginal <- as.POSIXct(recordTableSample$DateTimeOriginal)
recordTableSample$Date <- as.Date(recordTableSample$Date)
recordTableSample$Time <- chron::times(recordTableSample$Time)

camtraps$Setup_date <- as.Date(camtraps$Setup_date, format = "%d/%m/%Y")
camtraps$Retrieval_date <- as.Date(camtraps$Retrieval_date, format = "%d/%m/%Y")
```

## Plot observations

The package provides a function to plot the observations for each camera.

```{r}
plot_points(recordTableSample,
            camera_col = "Station",
            date_col = "Date", 
            time_col = "Time")
```

If a `timestamp_col` is present, it can also be used.

```{r}
plot_points(recordTableSample,
            camera_col = "Station",
            timestamp_col = "DateTimeOriginal")
```

It is also possible to provide a column for points colors:

```{r}
plot_points(recordTableSample,
            camera_col = "Station",
            points_col = "Species",
            timestamp_col = "DateTimeOriginal")
```

By providing additional info, it is also possible to vizualise the sampling period on the same graph.

```{r}
plot_points(recordTableSample, 
            camera_col = "Station", 
            points_col = "Species",
            timestamp_col = "DateTimeOriginal",
            caminfo = camtraps,
            caminfo_setup = "Setup_date",
            caminfo_retrieval = "Retrieval_date")
```

Various options are available to customize this graph:

```{r}
spp <- unique(recordTableSample$Species)
pal <- RColorBrewer::brewer.pal(length(spp), "Set2")

plot_points(recordTableSample, 
            camera_col = "Station", 
            points_col = "Species",
            timestamp_col = "DateTimeOriginal",
            caminfo = camtraps,
            caminfo_setup = "Setup_date",
            caminfo_retrieval = "Retrieval_date",
            fill_rect = NA,
            col_rect = "black", 
            height_rect = 0.3,
            ptsize = 3,
            cols = pal)
```

Using `ggiraph`, the plot can also be made interactive:

```{r}
p <- plot_points(recordTableSample, 
                 camera_col = "Station", 
                 points_col = "Species",
                 timestamp_col = "DateTimeOriginal",
                 caminfo = camtraps,
                 caminfo_setup = "Setup_date",
                 caminfo_retrieval = "Retrieval_date",
                 interactive = TRUE)
ggiraph::girafe(ggobj = p)
```

## Plot cameras

The package also provides a function to plot the cameras with Leaflet.

Here, the dataset is already projected using the UTM zone 50 (East Asia)/ Therefore, we provide the EPSG code to use (EPSG:32650).

```{r}
plot_map(camtraps, 
         cam_col = "Station",
         lat_col = "utm_y", lon_col = "utm_x", 
         crs = 32650)
```

## Plot species

The package also includes a simple function to plot species counts.

```{r}
plot_species_bars(recordTableSample, 
                  spp_col = "Species")
```

If there is a count column, it can also be included.

```{r}
with_count <- recordTableSample |> 
  mutate(count = 2)

plot_species_bars(with_count, 
                  spp_col = "Species", count_col = "count")
```

Finally, if there is an observation type column, `NA` values in the species column will be replaced with the values in observation type.

```{r}
with_obstype <- recordTableSample |> 
  mutate(type = "animal")
with_obstype <- rbind(with_obstype,
                      c(rep(NA, 11), "human"))

plot_species_bars(with_obstype, 
                  spp_col = "Species", obs_col = "type")
```
